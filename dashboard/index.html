<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FarmVista • Dashboard</title>

  <!-- Styles (theme first, then app) -->
  <link rel="stylesheet" href="../assets/css/theme.css?v=11" />
  <link rel="stylesheet" href="../assets/css/app.css?v=11" />
</head>
<body>

  <!-- ===== INLINE SHELL (cache-proof) ===== -->
  <script type="module">
    const ICONS = {
      home:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10.5 12 4l9 6.5"/><path d="M5 10.5V20h14v-9.5"/><path d="M10 20v-5h4v5"/></svg>`,
      grid:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>`,
      droplet:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3c3.5 4.6 7 7.7 7 12a7 7 0 1 1-14 0c0-4.3 3.5-7.4 7-12z"/></svg>`,
      tractor:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="17" r="3"/><circle cx="18" cy="15" r="2"/><path d="M5 17h-2v-4l3-2 5 2 2-4h4l1 4h-5m-7 4h10"/></svg>`,
      chart:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><rect x="6" y="10" width="3" height="8"/><rect x="11" y="6" width="3" height="12"/><rect x="16" y="12" width="3" height="6"/></svg>`,
      bell:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 9h18c0-2-3-2-3-9"/><path d="M10 21h4"/></svg>`,
      user:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M6 20c2-3 10-3 12 0"/></svg>`,
      logout:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><path d="M16 17l5-5-5-5"/><path d="M21 12H9"/></svg>`
    };

    class FVShell extends HTMLElement {
      constructor(){
        super();
        const r = this.attachShadow({mode:'open'});
        r.innerHTML = `
          <style>
            :host{
              display:block;
              /* Shell-specific variables (set explicit values so Safari can’t “lose” them) */
              --shell-header-bg: #3B7E46;   /* solid FarmVista green */
              --shell-sub-bg:    #CBCDCB;   /* gunmetal */
              --shell-accent:    #D0C542;   /* yellow underline */
              --sidebar-w:       300px;
            }
            .container{ width:min(1100px,100%); margin-inline:auto; padding:0 16px; }

            /* HEADER */
            header.fv-header{ position:sticky; top:0; z-index:6; }
            .hdr-top{ background:var(--shell-header-bg); color:#fff; border-bottom:1px solid rgba(0,0,0,.15); }
            .hdr-top .bar{ height:56px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
            .brand{ font-weight:800; letter-spacing:.3px; font-size:20px; color:#fff; }
            .hdr-sub{ background:var(--shell-sub-bg); color:#141514; }
            .hdr-sub .bar{ min-height:40px; display:flex; align-items:center; }
            .hdr-sub .accent{ height:3px; background:var(--shell-accent); }

            .btn-plain{
              display:inline-flex; align-items:center; justify-content:center;
              width:40px; height:40px; border-radius:9px; cursor:pointer; font-size:22px;
              background: rgba(255,255,255,.08);
              border:1px solid rgba(255,255,255,.28);
              color:#fff; transition:transform .02s ease;
            }
            .btn-plain:active{ transform:translateY(1px); }
            .btn-plain:focus{ outline:3px solid #b9e1c4; outline-offset:1px; }

            /* WHITE OVERLAY DRAWER */
            aside.fv-sidebar{
              position:fixed; inset:0 auto 0 0; width:var(--sidebar-w);
              background:#fff; color:#141514;
              border-right:1px solid #e2e5e5;
              transform:translateX(-100%); transition:transform .18s ease-out;
              z-index:999; display:flex; flex-direction:column;
              overflow-y:auto; overscroll-behavior:contain; -webkit-overflow-scrolling:touch; touch-action:pan-y;
              box-shadow:0 10px 22px rgba(0,0,0,.18);
            }
            .sd-head{ padding:16px 16px 12px; background:#fff; border-bottom:1px solid #e2e5e5; }
            .sd-head img{ display:block; max-width:100%; height:44px; object-fit:contain; }

            nav.sd-menu{ padding:8px 8px; }
            .nav-item{
              display:flex; align-items:center; gap:12px;
              padding:12px 10px; border-radius:10px; text-decoration:none;
              color:#232523; transition:background .15s ease;
            }
            .nav-item:hover{ background:#f4f6f4; }
            .nav-item .i{ width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; color:#2f3530; }
            .nav-item .t{ font-size:16px; }
            .nav-item.active{ background:#3B7E46; color:#fff; }
            .nav-item.active .i{ color:#fff; }

            .sd-foot{ margin-top:auto; padding:14px 16px; border-top:1px solid #e2e5e5; font-size:13px; display:grid; gap:6px; }
            .status{ display:flex; align-items:center; gap:8px; color:#2b2e2b; }
            .dot{ width:10px; height:10px; border-radius:999px; background:#2BB673; box-shadow:0 0 0 2px #dcefe6 inset; }
            .muted{ color:#6a6d6a; }

            .scrim{ position:fixed; inset:0; background:rgba(0,0,0,.45); opacity:0; pointer-events:none; transition:opacity .18s ease-out; z-index:998; }

            main.fv-main{ padding:18px 16px 44px; }
            footer.fv-footer{ background:#CBCDCB; color:#2b2e2b; border-top:3px solid #D0C542; padding:12px 0; }

            #navToggle{ display:none; }
            #navToggle:checked ~ aside.fv-sidebar{ transform:translateX(0); }
            #navToggle:checked ~ .scrim{ opacity:1; pointer-events:auto; }

            ::slotted(.breadcrumbs){ display:flex; flex-wrap:wrap; align-items:center; gap:6px; font-size:13px; }
            ::slotted(.breadcrumbs a){ color:#0e4d26; padding:4px 6px; border-radius:6px; text-decoration:none; }
            ::slotted(.breadcrumbs a:hover){ background:rgba(59,126,70,.18); color:#0e4d26; }
            ::slotted(.breadcrumbs .sep){ opacity:.65; }
          </style>

          <input id="navToggle" type="checkbox" hidden />

          <header class="fv-header">
            <div class="hdr-top">
              <div class="container bar">
                <label for="navToggle" class="btn-plain burger" aria-label="Open menu" title="Menu">
                  <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
                </label>
                <div class="brand">FarmVista</div>
                <button class="btn-plain" title="User menu">⚙️</button>
              </div>
            </div>
            <div class="hdr-sub">
              <div class="container bar"><slot name="breadcrumbs"></slot></div>
              <div class="accent"></div>
            </div>
          </header>

          <aside class="fv-sidebar" aria-label="Primary">
            <div class="sd-head"><img class="logo-img" alt="FarmVista logo" /></div>

            <nav class="sd-menu">
              <a class="nav-item" data-route="dashboard" href="#"><span class="i">${ICONS.home}</span><span class="t">Home</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.grid}</span><span class="t">Grain Tracking</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.droplet}</span><span class="t">Crop Production</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.tractor}</span><span class="t">Equipment</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.chart}</span><span class="t">Reports</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.bell}</span><span class="t">Alerts</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.user}</span><span class="t">Account Details</span></a>
              <a class="nav-item" href="#"><span class="i">${ICONS.logout}</span><span class="t">Logout</span></a>
            </nav>

            <div class="sd-foot">
              <div class="status"><span class="dot"></span>All Systems Operational</div>
              <div class="muted">App Version <span class="ver">1.0.0</span></div>
            </div>
          </aside>

          <label class="scrim" for="navToggle" aria-hidden="true"></label>

          <main class="fv-main"><slot></slot></main>

          <footer class="fv-footer">
            <div class="container"><small>© <span id="y"></span> FarmVista • All rights reserved.</small></div>
          </footer>
        `;

        const y = r.getElementById('y'); if (y) y.textContent = new Date().getFullYear();

        // repo-safe prefix for links/assets
        const parts = location.pathname.split('/').filter(Boolean);
        const up = Math.max(0, parts.length - 1);
        const prefix = '../'.repeat(up);

        const logo = r.querySelector('.logo-img'); if (logo) logo.src = `${prefix}assets/icons/logo.png`;
        const dash = r.querySelector('[data-route="dashboard"]');
        if (dash) { dash.setAttribute('href', `${prefix}dashboard/`); if (location.pathname.includes('/dashboard/')) dash.classList.add('active'); }
      }
    }
    customElements.define('fv-shell', FVShell);
  </script>
  <!-- ===== /INLINE SHELL ===== -->

  <!-- Use the component -->
  <fv-shell version="1.0.0">
    <nav slot="breadcrumbs" class="breadcrumbs" aria-label="Breadcrumb">
      <a href="../">Home</a><span class="sep">›</span><span>Dashboard</span>
    </nav>

    <div class="container page stack">
      <div class="card stack">
        <h1>Dashboard</h1>
        <p class="lead">Header is solid green, breadcrumbs sit on a gunmetal bar, and the white drawer slides in from the left with icons.</p>

        <div style="display:flex; gap:12px; flex-wrap: wrap;">
          <button class="btn">Secondary</button>
          <button class="btn btn-primary">Primary</button>
          <span class="badge brand">Badge</span>
        </div>
      </div>

      <div class="card">
        <h2 style="margin-bottom:8px;">Recent Activity</h2>
        <table class="table">
          <thead><tr><th>When</th><th>Item</th><th>Status</th></tr></thead>
          <tbody>
            <tr><td>Today</td><td>Grain ticket import</td><td><span class="badge">Processed</span></td></tr>
            <tr><td>Yesterday</td><td>Equipment service log</td><td><span class="badge">Scheduled</span></td></tr>
            <tr><td>Oct 1</td><td>Moisture sampling</td><td><span class="badge">Logged</span></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </fv-shell>

  <noscript>
    <div class="container page"><div class="card">JavaScript is required for the FarmVista shell.</div></div>
  </noscript>
</body>
</html>