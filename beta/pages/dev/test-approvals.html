<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test – Work Orders Needing Approval</title>

  <!-- Load your normal Firebase + FVData stack -->
  <script src="/Farm-vista/js/firebase-config.js"></script>
  <script src="/Farm-vista/js/fv-data.js"></script>
</head>

<body style="font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif; padding: 20px;">

  <h2>Test – Work Orders Needing Approval</h2>

  <p><strong>Needs approved count:</strong> <span id="needs-count">loading…</span></p>

  <h3>Debug log</h3>
  <pre id="log" style="background:#eee; padding:10px; border-radius:6px; white-space:pre-wrap; font-size:12px;"></pre>

  <script>
    async function runTest() {
      const needsSpan = document.getElementById("needs-count");
      const log = document.getElementById("log");

      try {
        if (!window.FVData || typeof FVData.getWhere !== "function") {
          needsSpan.textContent = "FVData.getWhere not available";
          log.textContent = "FVData or FVData.getWhere is undefined. Make sure fv-data.js is loading.";
          return;
        }

        log.textContent += "Calling FVData.ready()…\n";
        await FVData.ready();

        log.textContent += "Querying fieldMaintenance where status == \"needs approved\"…\n\n";

        const docs = await FVData.getWhere(
          "fieldMaintenance",
          "status",
          "==",
          "needs approved",
          { limit: 500 }
        ) || [];

        needsSpan.textContent = docs.length.toString();

        log.textContent += `Docs with status === "needs approved": ${docs.length}\n\n`;

        docs.forEach(d => {
          log.textContent += `ID: ${d.id || "(no id)"}\n`;
          log.textContent += JSON.stringify(d, null, 2) + "\n\n";
        });

        if (!docs.length) {
          log.textContent += "No docs matched status === \"needs approved\".\n";
        }

      } catch (err) {
        needsSpan.textContent = "ERROR";
        log.textContent += "\nERROR:\n" + (err && err.message ? err.message : err);
      }
    }

    document.addEventListener("DOMContentLoaded", runTest);
  </script>

</body>
</html>