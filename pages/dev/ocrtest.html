<!doctype html>
<html>
  <body>
    <h2>OCR Test Page (JSON)</h2>

    <p>
      1) Click "Choose File" and select a RECEIPT image or PDF<br>
      2) Click "Scan Receipt"<br>
      3) Watch the status line and result box below
    </p>

    <input type="file" id="file" />
    <button id="btn">Scan Receipt</button>

    <p id="status" style="margin-top:10px; font-weight:bold; color:#333;">
      Status: Waiting for file…
    </p>

    <pre id="out" style="white-space:pre-wrap; border:1px solid #ccc; padding:10px; margin-top:10px; min-height:120px;">
    </pre>

    <script>
      const btn = document.getElementById("btn");
      const out = document.getElementById("out");
      const statusEl = document.getElementById("status");

      btn.addEventListener("click", async () => {
        const input = document.getElementById("file");
        const file = input.files[0];

        if (!file) {
          statusEl.textContent = "Status: Pick a file first.";
          out.textContent = "";
          return;
        }

        statusEl.textContent = "Status: Reading file…";

        const reader = new FileReader();
        reader.onload = async () => {
          try {
            // reader.result is like: data:application/pdf;base64,AAAA...
            const base64 = reader.result.split(",")[1];

            statusEl.textContent = "Status: Sending to OCR…";

            const res = await fetch(
              "https://fv-ocr-300398089669.us-central1.run.app/fvOcr",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  content: base64,
                  mimeType: file.type || "application/pdf"
                })
              }
            );

            const text = await res.text();
            statusEl.textContent = "Status: Response received.";
            out.textContent = text;
          } catch (err) {
            statusEl.textContent = "Status: ERROR – see below.";
            out.textContent = "ERROR: " + err.message;
            console.error(err);
          }
        };

        reader.readAsDataURL(file);
      });
    </script>
  </body>
</html>
