<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FarmVista ‚Ä¢ Map Dev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#3B7E46" />

  <!-- ABSOLUTE PATHS -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png" />
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png" />
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css" />
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css" />

  <!-- Ensure fv-shell -->
  <script>
    (function () {
      if (!customElements.get('fv-shell')) {
        const s = document.createElement('script');
        s.src = '/Farm-vista/js/fv-shell.js';
        s.defer = true;
        document.head.appendChild(s);
      }
    })();
  </script>

  <!-- Map helper -->
  <script src="/Farm-vista/js/fv-map.js"></script>

  <style>
    :root{
      --card-max:1100px;
      --page-bottom-gap:96px;
      --accent:#2F6C3C;
    }
    body{ background:var(--app-bg,var(--surface)); }

    .wrap{
      max-width:var(--card-max);
      margin:0 auto;
      padding:clamp(14px,3vw,22px);
      padding-bottom:calc(env(safe-area-inset-bottom,0px) + var(--ftr-h,42px) + var(--page-bottom-gap))!important;
      box-sizing:border-box;
    }

    .hero{
      border:1px solid var(--border);
      border-radius:14px;
      background:var(--surface);
      box-shadow:var(--shadow,0 8px 20px rgba(0,0,0,.08));
      overflow:hidden;
      margin-bottom:var(--page-bottom-gap);
    }
    .hero-head{
      display:grid;
      grid-template-columns:36px 1fr;
      gap:12px;
      align-items:center;
      padding:14px 16px;
      background:linear-gradient(90deg, rgba(47,108,60,.12), transparent);
      border-bottom:1px solid var(--border);
    }
    .hero-head .icon{
      width:24px;
      height:24px;
      display:grid;
      place-items:center;
      color:var(--accent);
    }
    .hero-head h1{
      margin:0;
      font-size:clamp(20px,3.2vw,26px);
      line-height:1.2;
    }
    .muted{ color:var(--muted,#67706B); }

    .body{
      padding:16px;
      display:grid;
      gap:14px;
    }

    .mode-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .mode-pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 18px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--card-surface,var(--surface));
      font-weight:800;
      cursor:pointer;
    }
    .mode-pill.mode-active{
      background:#2F6C3C;
      color:#fff !important;
      border-color:#2F6C3C;
    }

    .map-help{
      font-size:0.9rem;
      color:var(--muted,#67706B);
      margin-top:6px;
    }

    .map-frame{
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--card-surface,var(--surface));
      overflow:hidden;
    }
    #mapCanvas{
      width:100%;
      height:360px;
      background:#111;
    }

    .status-line{
      font-size:0.9rem;
      color:var(--muted,#67706B);
      margin-top:6px;
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width:800px){
      .row{ grid-template-columns:1fr; }
    }

    .field label{
      display:block;
      font-weight:800;
      margin-bottom:4px;
    }
    .input{
      width:100%;
      font:inherit;
      font-size:16px;
      color:var(--text);
      background:var(--card-surface,var(--surface));
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px 12px;
    }
    .input[readonly]{
      background:var(--card-surface,var(--surface));
    }
  </style>

  <!-- Init callback for Google Maps -->
  <script>
    function initMapDev() {
      if (!window.FVMap || !window.FVMap.initPicker) {
        console.error("FVMap helper not loaded.");
        return;
      }
      window.FVMap.initPicker({
        containerId: 'mapCanvas',
        latInputId: 'lat',
        lngInputId: 'lng',
        zoomInputId: 'zoom',
        statusId: 'statusLine',
        useLocationBtnId: 'btnUseLocation',
        mapBtnId: 'btnMap',
        satBtnId: 'btnSat',
        initialCenter: { lat: 39.8283, lng: -98.5795 } // center of US
      });
    }
  </script>

  <!-- Google Maps JS (uses your API key) -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3sLBWFDsoZRLmfQ19hKLoH_nMrHEFQME&callback=initMapDev">
  </script>
</head>
<body>
  <fv-shell>
    <div class="wrap">
      <section class="hero">
        <header class="hero-head">
          <div class="icon" aria-hidden="true">üìç</div>
          <div>
            <h1>Map Dev ‚Äî Pin Drop</h1>
            <p class="muted">Test dropping a pin, using your location, and switching between map and satellite.</p>
          </div>
        </header>

        <div class="body">
          <div class="mode-row">
            <button id="btnUseLocation" type="button" class="mode-pill">Use my location</button>
            <button id="btnMap" type="button" class="mode-pill mode-active">Map</button>
            <button id="btnSat" type="button" class="mode-pill">Satellite</button>
          </div>
          <div class="map-help">
            Tap anywhere on the map to drop a pin. Drag the map to move around.  
            If ‚ÄúUse my location‚Äù doesn‚Äôt work, check Safari ‚Üí Settings ‚Üí Location for dkillam05.github.io.
          </div>

          <div class="map-frame">
            <div id="mapCanvas"></div>
          </div>

          <div id="statusLine" class="status-line">Waiting for pin‚Ä¶</div>

          <div class="row">
            <div class="field">
              <label for="lat">Latitude</label>
              <input id="lat" class="input" type="text" readonly>
            </div>
            <div class="field">
              <label for="lng">Longitude</label>
              <input id="lng" class="input" type="text" readonly>
            </div>
          </div>

          <!-- Hidden zoom, just in case we want it later -->
          <input id="zoom" type="hidden">
        </div>
      </section>
    </div>
  </fv-shell>
</body>
</html>