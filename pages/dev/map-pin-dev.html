<!-- =====================================================================
/Farm-vista/pages/dev/map-pin-dev.html  (FULL FILE)
Dev map pin tester:
 ‚Ä¢ Uses /Farm-vista/js/map-pin.js for reusable picker
 ‚Ä¢ Base map + Satellite (ESRI World Imagery) toggle
 ‚Ä¢ Inline status instead of alert() so "Suppress dialogs" can't break it
===================================================================== -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista ‚Ä¢ Dev Map Pin Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <!-- PWA + icons -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>

  <!-- Theme + app CSS -->
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <!-- Ensure fv-shell -->
  <script>
    (function(){
      if(!customElements.get('fv-shell')){
        const s=document.createElement('script');
        s.src='/Farm-vista/js/fv-shell.js';
        s.defer=true;
        document.head.appendChild(s);
      }
    })();
  </script>

  <!-- Leaflet CSS (map engine) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    :root{
      --card-max: 1100px;
      --page-bottom-gap: 96px;
      --accent: #2F6C3C;
    }

    body{ background:var(--app-bg,var(--surface)); }

    .wrap{
      max-width:var(--card-max);
      margin:0 auto;
      padding:clamp(14px,3vw,22px);
      padding-bottom:calc(env(safe-area-inset-bottom,0px) + var(--ftr-h,42px) + var(--page-bottom-gap))!important;
      box-sizing:border-box;
    }

    .hero{
      border:1px solid var(--border);
      border-radius:14px;
      background:var(--surface);
      box-shadow:var(--shadow,0 8px 20px rgba(0,0,0,.08));
      overflow:hidden;
    }

    .hero-head{
      display:grid;
      grid-template-columns:36px 1fr;
      gap:12px;
      align-items:center;
      padding:14px 16px;
      background:linear-gradient(90deg, rgba(47,108,60,.12), transparent);
      border-bottom:1px solid var(--border);
    }
    .hero-head .icon{
      width:24px; height:24px;
      display:grid; place-items:center;
      color:var(--accent);
    }
    .hero-head h1{
      margin:0;
      font-size:clamp(20px,3.2vw,26px);
      line-height:1.2;
    }
    .muted{ color:var(--muted,#67706B); }

    .body{
      padding:12px 16px 16px;
      display:grid;
      gap:12px;
    }

    .top-bar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:space-between;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 16px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--card-surface,var(--surface));
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      color:var(--text);
      min-height:36px;
    }
    .btn-primary{
      background:#2F6C3C;
      border-color:transparent;
      color:#fff;
    }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; }

    .hint{
      font-size:0.9rem;
      color:var(--muted,#67706B);
    }

    #map{
      width:100%;
      height:440px;
      border-radius:12px;
      overflow:hidden;
      border:1px solid var(--border);
    }

    .coords-row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width:720px){
      .coords-row{ grid-template-columns:1fr; }
    }

    .field label{
      display:block;
      font-weight:800;
      margin:6px 0 4px;
    }
    .input{
      width:100%;
      font:inherit;
      font-size:15px;
      background:var(--card-surface,var(--surface));
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px 10px;
    }

    #mapStatus{
      font-size:0.85rem;
      color:var(--muted,#67706B);
      margin-top:4px;
      min-height:1.2em;
    }

    .pill-toggle{
      display:inline-flex;
      gap:4px;
      padding:2px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--card-surface,var(--surface));
    }
    .pill-toggle button{
      border:none;
      background:transparent;
      padding:4px 10px;
      border-radius:999px;
      font:inherit;
      font-size:0.85rem;
      cursor:pointer;
      color:var(--muted,#67706B);
    }
    .pill-toggle button.active{
      background:#2F6C3C;
      color:#fff;
    }
  </style>
</head>
<body>
  <fv-shell>
    <div class="wrap">
      <section class="hero">
        <header class="hero-head">
          <div class="icon">üìç</div>
          <div>
            <h1>Dev ‚Ä¢ Map Pin Picker</h1>
            <p class="muted">Drop a pin on the map or use your location. This will become the shared map component for other forms.</p>
          </div>
        </header>

        <div class="body">
          <div class="top-bar">
            <button id="btnUseLocation" class="btn btn-primary" type="button">
              Use my location
            </button>

            <div class="pill-toggle" aria-label="Base map style">
              <button id="styleRoad" class="active" type="button">Map</button>
              <button id="styleSat" type="button">Satellite</button>
            </div>
          </div>
          <div class="hint">Tap anywhere on the map to drop a pin. Drag to move the map.</div>

          <div id="map"></div>

          <div id="mapStatus">Waiting for pin‚Ä¶</div>

          <div class="coords-row">
            <div class="field">
              <label for="lat">Latitude</label>
              <input id="lat" class="input" type="text" readonly>
            </div>
            <div class="field">
              <label for="lng">Longitude</label>
              <input id="lng" class="input" type="text" readonly>
            </div>
          </div>
        </div>
      </section>
    </div>
  </fv-shell>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>

  <!-- Shared map picker logic -->
  <script type="module" src="/Farm-vista/js/map-pin.js"></script>

  <script>
    // Hook up the dev page once DOM + Leaflet are ready.
    document.addEventListener('DOMContentLoaded', ()=>{
      if(!window.FVMapPin || typeof window.FVMapPin.initPicker !== 'function'){
        console.error('FVMapPin.initPicker missing');
        return;
      }

      window.FVMapPin.initPicker({
        mapId: 'map',
        latInputId: 'lat',
        lngInputId: 'lng',
        statusId: 'mapStatus',
        useLocationBtnId: 'btnUseLocation',
        styleRoadBtnId: 'styleRoad',
        styleSatBtnId: 'styleSat'
      });
    });
  </script>
</body>
</html>