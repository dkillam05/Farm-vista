<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista • Dev • Dictation Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <!-- ABSOLUTE PATHS -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <style>
    :root{
      --accent:#2F6C3C;
      --card-max:960px;
    }
    body{
      background:var(--app-bg,var(--surface,#f3f4f6));
      color:var(--text,#111827);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    .wrap{
      max-width:var(--card-max);
      margin:0 auto;
      padding:16px;
      box-sizing:border-box;
      display:grid;
      gap:16px;
    }
    .hero{
      border:1px solid var(--border,#d1d5db);
      border-radius:14px;
      background:var(--surface,#fff);
      box-shadow:0 8px 20px rgba(0,0,0,.06);
      overflow:hidden;
    }
    .hero-head{
      padding:12px 14px;
      border-bottom:1px solid var(--border,#d1d5db);
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
    }
    .hero-title{
      font-size:1rem;
      font-weight:700;
    }
    .hero-sub{
      font-size:.8rem;
      color:var(--muted,#6b7280);
    }
    .status-pill{
      display:inline-flex;
      align-items:center;
      padding:4px 10px;
      border-radius:999px;
      font-size:.75rem;
      font-weight:500;
      border:1px solid transparent;
      white-space:nowrap;
    }
    .status-pill.ok{
      background:rgba(22,163,74,.06);
      color:#166534;
      border-color:rgba(22,163,74,.5);
    }
    .status-pill.bad{
      background:rgba(220,38,38,.06);
      color:#b91c1c;
      border-color:rgba(220,38,38,.5);
    }
    .body{
      padding:14px 16px 16px;
      display:grid;
      gap:12px;
    }
    .field{
      display:grid;
      gap:6px;
    }
    .label{
      font-size:.85rem;
      font-weight:700;
    }
    .ta-wrap{
      position:relative;
    }
    .textarea{
      width:100%;
      min-height:120px;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid var(--border,#d1d5db);
      resize:vertical;
      font-family:inherit;
      font-size:.9rem;
      line-height:1.4;
    }
    .textarea.fm-notes{
      padding-right:52px;
    }
    .hint{
      font-size:.8rem;
      color:var(--muted,#6b7280);
    }

    /* your mic styling from maintenance-add */
    .mic-btn{
      position:absolute;
      right:10px;
      bottom:10px;
      width:36px;
      height:36px;
      border-radius:10px;
      border:1px solid var(--border);
      background:var(--surface);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .mic-btn[disabled]{
      opacity:.6;
      cursor:not-allowed;
    }
    .mic-svg{
      width:18px;
      height:18px;
      display:block;
    }
    .mic-active{
      background:#2F6C3C;
      color:#fff;
      border-color:#2F6C3C;
    }

    @media (max-width:700px){
      .wrap{ padding:12px; }
      .hero{ border-radius:12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Card: status -->
    <section class="hero">
      <div class="hero-head">
        <div>
          <div class="hero-title">Dev • Dictation Test</div>
          <div class="hero-sub">Using fv-dictation.js (same logic as maintenance-add)</div>
        </div>
        <div id="speechStatus" class="status-pill">Checking…</div>
      </div>
      <div class="body">
        <p class="hint">
          On your phone: tap the mic, speak, and it should type into the box just like the Add Maintenance page.
        </p>
      </div>
    </section>

    <!-- Card: main notes -->
    <section class="hero">
      <div class="hero-head">
        <div class="hero-title">Test 1 • Notes</div>
      </div>
      <div class="body">
        <div class="field">
          <label for="notes" class="label">Notes</label>
          <div class="ta-wrap">
            <textarea id="notes" class="textarea fm-notes" placeholder="Talk into the mic and see if it types here…"></textarea>
            <button id="mic-notes" type="button" class="mic-btn" aria-label="Start dictation">
              <svg class="mic-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.92V21H9v2h6v-2h-2v-3.08A7 7 0 0 0 19 11h-2z"/>
              </svg>
            </button>
          </div>
          <div class="hint">This should behave exactly like the mic on your Add Field Maintenance page.</div>
        </div>
      </div>
    </section>

    <!-- Card: second textarea -->
    <section class="hero">
      <div class="hero-head">
        <div class="hero-title">Test 2 • Priority Reason</div>
      </div>
      <div class="body">
        <div class="field">
          <label for="priorityReason" class="label">Priority reason</label>
          <div class="ta-wrap">
            <textarea id="priorityReason" class="textarea fm-notes" placeholder="Second mic wiring test…"></textarea>
            <button id="mic-priority" type="button" class="mic-btn" aria-label="Start dictation for priority reason">
              <svg class="mic-svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.92V21H9v2h6v-2h-2v-3.08A7 7 0 0 0 19 11h-2z"/>
              </svg>
            </button>
          </div>
          <div class="hint">If Test 1 works, this should too. If one works and the other doesn’t, we know it’s an ID wiring issue.</div>
        </div>
      </div>
    </section>
  </div>

  <script type="module">
    import { wireDictation } from '/Farm-vista/js/fv-dictation.js';

    const statusEl = document.getElementById('speechStatus');

    const supported =
      ('webkitSpeechRecognition' in window) ||
      ('SpeechRecognition' in window);

    if (supported) {
      statusEl.textContent = 'Web Speech: SUPPORTED';
      statusEl.classList.remove('bad');
      statusEl.classList.add('ok');
    } else {
      statusEl.textContent = 'Web Speech: NOT SUPPORTED (mic will hide)';
      statusEl.classList.remove('ok');
      statusEl.classList.add('bad');
    }

    // Wire both mics using the shared helper
    wireDictation('mic-notes', 'notes');
    wireDictation('mic-priority', 'priorityReason');
  </script>
</body>
</html>
