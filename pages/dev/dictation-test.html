<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista • Dev • Dictation Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <!-- ===========================
       ABSOLUTE PATHS (REQUIRED)
       =========================== -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>

  <!-- Theme + base app styles -->
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <style>
    body{
      background:var(--app-bg, #f3f4f6);
      color:var(--text, #111827);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    .page{
      max-width:960px;
      margin:0 auto;
      padding:16px;
    }
    .dev-header{
      margin-bottom:16px;
    }
    .dev-header h1{
      font-size:1.25rem;
      font-weight:600;
      margin:0 0 4px;
    }
    .dev-header p{
      margin:0;
      font-size:.875rem;
      color:var(--muted, #6b7280);
    }

    .status-pill{
      display:inline-flex;
      align-items:center;
      padding:4px 10px;
      border-radius:999px;
      font-size:.75rem;
      font-weight:500;
      margin-top:8px;
      border:1px solid transparent;
    }
    .status-pill.ok{
      background:rgba(22,163,74,.06);
      color:#166534;
      border-color:rgba(22,163,74,.4);
    }
    .status-pill.bad{
      background:rgba(220,38,38,.06);
      color:#b91c1c;
      border-color:rgba(220,38,38,.4);
    }

    .hero-card{
      border-radius:16px;
      background:var(--surface, #ffffff);
      border:1px solid var(--border-subtle, #e5e7eb);
      box-shadow:0 10px 30px rgba(15,23,42,.06);
      padding:16px;
      margin-bottom:16px;
    }
    .hero-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
      gap:12px;
    }
    .hero-title{
      font-size:1rem;
      font-weight:600;
    }
    .hero-sub{
      font-size:.8rem;
      color:var(--muted, #6b7280);
    }
    .hero-body{
      position:relative;
    }

    .notes-label{
      font-size:.8rem;
      font-weight:500;
      margin-bottom:4px;
      color:var(--muted-strong, #4b5563);
    }
    .notes-textarea{
      width:100%;
      min-height:120px;
      padding:10px 10px 10px 10px;
      border-radius:12px;
      border:1px solid var(--border, #d1d5db);
      resize:vertical;
      font-family:inherit;
      font-size:.9rem;
      line-height:1.4;
      background:var(--surface, #ffffff);
      color:inherit;
    }
    .notes-wrap{
      position:relative;
    }
    .notes-hint{
      margin-top:4px;
      font-size:.75rem;
      color:var(--muted, #6b7280);
    }

    .block{
      padding:8px 0;
    }

    @media (max-width:640px){
      .page{
        padding:12px;
      }
      .hero-card{
        border-radius:12px;
        padding:12px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="dev-header">
      <h1>Dev • Dictation Test</h1>
      <p>Testing <code>fv-dictation.js</code> (Web Speech support + mic button wiring)</p>
      <div id="speech-status" class="status-pill">Checking support…</div>
    </header>

    <!-- Card 1: Standard notes dictation -->
    <section class="hero-card">
      <div class="hero-head">
        <div>
          <div class="hero-title">Test 1 • Notes (main)</div>
          <div class="hero-sub">Square mic button in bottom-right corner of textarea</div>
        </div>
      </div>
      <div class="hero-body">
        <div class="block">
          <label class="notes-label" for="notes">Notes</label>
          <div class="notes-wrap">
            <textarea id="notes" class="notes-textarea" placeholder="Start typing notes, then tap the mic to add via voice…"></textarea>
            <!-- Empty button; fv-dictation will inject SVG + styling -->
            <button id="mic-notes"></button>
          </div>
          <p class="notes-hint">
            Expect: on supported browsers, mic shows as square button; tap once to start, tap again to stop.
          </p>
        </div>
      </div>
    </section>

    <!-- Card 2: Second instance, make sure multiple wiring works -->
    <section class="hero-card">
      <div class="hero-head">
        <div>
          <div class="hero-title">Test 2 • Secondary notes</div>
          <div class="hero-sub">Second textarea + mic using the same helper</div>
        </div>
      </div>
      <div class="hero-body">
        <div class="block">
          <label class="notes-label" for="notes-2">Secondary notes</label>
          <div class="notes-wrap">
            <textarea id="notes-2" class="notes-textarea" placeholder="Another textarea wired to its own mic button…"></textarea>
            <button id="mic-notes-2"></button>
          </div>
          <p class="notes-hint">
            If Test 1 works, this should behave exactly the same. If only one works, something is off with IDs or wiring.
          </p>
        </div>
      </div>
    </section>

    <section class="hero-card">
      <div class="hero-head">
        <div>
          <div class="hero-title">Debug Info</div>
          <div class="hero-sub">For your notes while testing</div>
        </div>
      </div>
      <div class="hero-body">
        <ul style="margin:0; padding-left:1.2rem; font-size:.8rem; color:var(--muted,#6b7280);">
          <li>If the status pill says <strong>NOT SUPPORTED</strong>, the mic buttons will auto-hide.</li>
          <li>If it says <strong>wireDictation is not defined</strong>, then <code>fv-dictation.js</code> did not load correctly.</li>
          <li>On desktop Chrome, you should see the mic and be prompted to allow microphone access.</li>
        </ul>
      </div>
    </section>
  </div>

  <!-- ===========================
       Dictation helper + wiring
       =========================== -->
  <script src="/Farm-vista/js/fv-dictation.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const statusEl = document.getElementById('speech-status');

      // Check basic Web Speech API support
      const speechSupported =
        'webkitSpeechRecognition' in window ||
        'SpeechRecognition' in window;

      if (!speechSupported) {
        if (statusEl) {
          statusEl.textContent = 'Speech recognition: NOT SUPPORTED in this browser';
          statusEl.classList.remove('ok');
          statusEl.classList.add('bad');
        }
        // Buttons will be hidden by fv-dictation.js when we wire them
      } else {
        if (statusEl) {
          statusEl.textContent = 'Speech recognition: SUPPORTED – wiring mic buttons…';
          statusEl.classList.remove('bad');
          statusEl.classList.add('ok');
        }
      }

      // Make sure helper actually loaded
      if (typeof window.wireDictation !== 'function') {
        if (statusEl) {
          statusEl.textContent = 'Error: wireDictation is not defined – check /Farm-vista/js/fv-dictation.js';
          statusEl.classList.remove('ok');
          statusEl.classList.add('bad');
        }
        return;
      }

      // Wire both test areas
      window.wireDictation('mic-notes', 'notes');
      window.wireDictation('mic-notes-2', 'notes-2');

      // If no speech support, override status text to be crystal clear
      if (!speechSupported && statusEl) {
        statusEl.textContent = 'Speech recognition: NOT SUPPORTED – mic buttons hidden by helper';
      }
    });
  </script>
</body>
</html>
