<!-- =====================================================================
/Farm-vista/pages/dev/dev.html  (FULL FILE)
Dev page:
 • 3 Firestore-backed fv-combos: Farm, Field, Topic
 • Uses fv-combo.js (data-fv-combo + data-fv-search="true")
 • Topics pulled from fieldMaintenanceTopics (label field)
===================================================================== -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista • Dev Combos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <!-- ABSOLUTE PATHS -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>

  <!-- Theme + app CSS -->
  <script defer src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <!-- fv-shell + fv-combo -->
  <script defer src="/Farm-vista/js/fv-shell.js"></script>
  <script defer src="/Farm-vista/js/fv-combo.js"></script>

  <style>
    .dev-page{
      max-width: 900px;
      margin: 0 auto;
      padding: 12px 16px 80px;
      box-sizing: border-box;
    }
    .dev-card{
      background: var(--card-bg,var(--surface));
      border-radius: 16px;
      padding: 16px 16px 20px;
      box-shadow: var(--card-shadow,0 2px 6px rgba(0,0,0,0.35));
    }
    .dev-card h1{
      font-size: 1.2rem;
      margin: 0 0 8px;
    }
    .dev-card p{
      margin: 0 0 16px;
      font-size: .9rem;
      opacity: .8;
    }
    .dev-group{
      margin-bottom: 16px;
    }
    .dev-group label{
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: .9rem;
    }
    .dev-status{
      margin-top: 8px;
      font-size: .8rem;
      opacity: .75;
    }
  </style>
</head>
<body>
  <fv-shell app-title="Dev • FV Combos" data-page-id="dev-combos">
    <main class="dev-page">
      <section class="dev-card">
        <h1>Dev — Firestore FV Combos</h1>
        <p>Three fv-combos wired to Firestore: Farm, Field, Topic. Search lives inside the dropdown panel.</p>

        <!-- FARM -->
        <div class="dev-group">
          <label for="farmSelect">Farm</label>
          <select id="farmSelect"
                  name="farmId"
                  data-fv-combo
                  data-fv-search="true"
                  placeholder="Select farm…">
          </select>
        </div>

        <!-- FIELD -->
        <div class="dev-group">
          <label for="fieldSelect">Field</label>
          <select id="fieldSelect"
                  name="fieldId"
                  data-fv-combo
                  data-fv-search="true"
                  placeholder="Select field…">
          </select>
        </div>

        <!-- TOPIC -->
        <div class="dev-group">
          <label for="topicSelect">Topic</label>
          <select id="topicSelect"
                  name="topicId"
                  data-fv-combo
                  data-fv-search="true"
                  placeholder="Select topic…">
          </select>
        </div>

        <div id="devStatus" class="dev-status">Initializing…</div>
      </section>
    </main>
  </fv-shell>

  <script type="module">
    import {
      ready,
      getFirestore,
      collection,
      getDocs,
      query,
      orderBy
    } from '/Farm-vista/js/firebase-init.js';

    const $ = (id) => document.getElementById(id);

    // Adjust these if needed to match your collections/fields
    const FS_CONFIG = {
      farm:  { coll: 'farms',                  labelField: 'name',  selectId: 'farmSelect',  statusKey: 'farm'  },
      field: { coll: 'fields',                 labelField: 'name',  selectId: 'fieldSelect', statusKey: 'field' },
      topic: { coll: 'fieldMaintenanceTopics', labelField: 'label', selectId: 'topicSelect', statusKey: 'topic' }
    };

    async function loadCollection(cfg){
      const selectEl = $(cfg.selectId);
      const statusEl = $('devStatus');
      if (!selectEl) return;

      try {
        statusEl.textContent = `Loading ${cfg.statusKey}s…`;

        const db = getFirestore();
        const qRef = query(
          collection(db, cfg.coll),
          orderBy(cfg.labelField)
        );
        const snap = await getDocs(qRef);

        // Clear & add placeholder
        selectEl.innerHTML = '';
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = `Select ${cfg.statusKey}…`;
        placeholder.disabled = true;
        placeholder.selected = true;
        selectEl.appendChild(placeholder);

        let count = 0;
        snap.forEach(doc => {
          const data = doc.data();
          const label = (data && data[cfg.labelField]) ? String(data[cfg.labelField]) : doc.id;
          const opt = document.createElement('option');
          opt.value = doc.id;
          opt.textContent = label;
          selectEl.appendChild(opt);
          count++;
        });

        statusEl.textContent = `Loaded ${count} ${cfg.statusKey}${count === 1 ? '' : 's'}.`;

        // Make sure fv-combo decorates it (safe even if already upgraded)
        if (window.FVCombo && window.FVCombo.upgradeSelect) {
          window.FVCombo.upgradeSelect(selectEl);
        }
      } catch (err) {
        console.error(`Error loading ${cfg.statusKey}:`, err);
        const statusEl = $('devStatus');
        if (statusEl) statusEl.textContent = `Error loading ${cfg.statusKey} — see console.`;
      }
    }

    (async () => {
      try {
        await ready();

        await Promise.all([
          loadCollection(FS_CONFIG.farm),
          loadCollection(FS_CONFIG.field),
          loadCollection(FS_CONFIG.topic)
        ]);

        const s = $('devStatus');
        if (s) s.textContent += '  (All combos ready.)';
      } catch (err) {
        console.error('Dev combo init error:', err);
        const s = $('devStatus');
        if (s) s.textContent = 'Error initializing page — see console.';
      }
    })();
  </script>
</body>
</html>