<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>QL-820NWB • DK-2205 PNG Label</title>

  <style>
    body{
      margin:0;
      padding:16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f6f6f6;
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:12px;
    }

    button{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid #bbb;
      background:#fff;
      font-weight:800;
      cursor:pointer;
    }

    .hint{
      font-size:13px;
      opacity:.7;
    }

    /* On-screen preview (NOT used for printing) */
    .preview{
      width: min(720px, 100%);
      margin:0 auto;
      background:#fff;
      border:2px dashed #999;
      border-radius:14px;
      padding:12px;
    }

    .label{
      border:2px solid #111;
      border-radius:14px;
      padding:14px;
    }

    .title{
      font-size:24px;
      font-weight:900;
      margin-bottom:8px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      margin:6px 0;
      font-size:15px;
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    .muted{
      opacity:.75;
      font-size:13px;
      margin-top:8px;
    }

    canvas{ display:none; }
  </style>
</head>

<body>
  <div class="controls">
    <button id="btnMakePng" type="button">Make PNG Label</button>
    <button id="btnRand" type="button">Randomize</button>
    <span class="hint">
      DK-2205 (62mm continuous) • Save Image → Import in Brother iPrint&Label
    </span>
  </div>

  <div class="preview">
    <div class="label">
      <div class="title" id="t1">DOWSON FARMS</div>

      <div class="row">
        <div><strong>ID</strong> <span class="mono" id="id">EQ-0001</span></div>
        <div><strong>Date</strong> <span class="mono" id="dt"></span></div>
      </div>

      <div class="row">
        <div><strong>Line 1</strong> <span id="l1">Test Label</span></div>
        <div><strong>Line 2</strong> <span id="l2">DK-2205</span></div>
      </div>

      <div class="muted">
        PNG width is locked to Brother-safe 62mm.
      </div>
    </div>
  </div>

  <canvas id="cnv"></canvas>

  <script>
    /* ============================================================
       DK-2205 (62mm continuous) — BROTHER SAFE DIMENSIONS
       ============================================================

       ⚠️ DO NOT CHANGE WIDTH
       696px width is the critical fix that prevents:
       "Failed to share file" in iPrint&Label
    ============================================================ */

    const LABEL_W = 696;   // EXACT 62mm width (Brother-safe)
    const LABEL_H = 1100;  // Label length (adjust if desired)

    function pad(n){ return String(n).padStart(2,'0'); }
    function today(){
      const d=new Date();
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }
    document.getElementById('dt').textContent = today();

    document.getElementById('btnRand').addEventListener('click', () => {
      const n = Math.floor(Math.random()*9000)+1000;
      document.getElementById('id').textContent = 'EQ-' + n;
      document.getElementById('l1').textContent = 'Scan Me';
      document.getElementById('l2').textContent = 'Unit ' + n;
      document.getElementById('dt').textContent = today();
    });

    function drawLabelToCanvas(){
      const cnv = document.getElementById('cnv');
      cnv.width = LABEL_W;
      cnv.height = LABEL_H;
      const ctx = cnv.getContext('2d');

      /* Background */
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,cnv.width,cnv.height);

      /* Border */
      ctx.strokeStyle = '#111111';
      ctx.lineWidth = 8;
      ctx.strokeRect(16,16,cnv.width-32,cnv.height-32);

      ctx.fillStyle = '#111111';

      const title = document.getElementById('t1').textContent;
      const id = document.getElementById('id').textContent;
      const dt = document.getElementById('dt').textContent;
      const l1 = document.getElementById('l1').textContent;
      const l2 = document.getElementById('l2').textContent;

      /* Title */
      ctx.font = 'bold 74px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(title, 48, 140);

      /* ID + Date */
      ctx.font = '700 44px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
      ctx.fillText('ID  ' + id, 48, 260);
      ctx.fillText('DATE ' + dt, 48, 320);

      /* Lines */
      ctx.font = '800 50px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('LINE 1', 48, 460);
      ctx.font = '600 56px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(l1, 48, 540);

      ctx.font = '800 50px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText('LINE 2', 48, 680);
      ctx.font = '600 56px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillText(l2, 48, 760);

      /* Footer */
      ctx.font = '500 32px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.globalAlpha = 0.7;
      ctx.fillText('DK-2205 • QL-820NWB • Bluetooth', 48, cnv.height - 70);
      ctx.globalAlpha = 1;

      return cnv;
    }

    document.getElementById('btnMakePng').addEventListener('click', () => {
      const cnv = drawLabelToCanvas();

      cnv.toBlob((blob) => {
        if(!blob){
          alert('PNG generation failed.');
          return;
        }

        const url = URL.createObjectURL(blob);
        window.open(url, '_blank');

        setTimeout(() => URL.revokeObjectURL(url), 15000);
      }, 'image/png');
    });
  </script>
</body>
</html>
