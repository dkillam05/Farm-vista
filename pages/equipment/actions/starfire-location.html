<!-- =====================================================================
/Farm-vista/pages/equipment/actions/starfire-location.html
Template – StarFire location moves (who/when/where)
===================================================================== -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista • StarFire Location Update</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <!-- PWA + icons -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>

  <!-- Theme + app CSS -->
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <!-- Shell (header/footer/drawer) -->
  <script src="/Farm-vista/js/fv-shell.js"></script>

  <style>
    :root{ --page-bottom-gap:56px; }

    body{
      background:var(--app-bg,var(--surface));
      min-height:100vh;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:clamp(14px,3vw,22px);
      padding-bottom:calc(
        env(safe-area-inset-bottom,0px)
        + var(--ftr-h,42px)
        + var(--page-bottom-gap)
      );
    }
    header.page{
      margin:8px 0 20px 0;
    }
    header.page h1{
      margin:0 0 6px 0;
      font-size:clamp(22px,3.5vw,28px);
      line-height:1.2;
    }
    header.page p{
      margin:0;
      color:var(--muted,#67706B);
      font-size:clamp(14px,2.4vw,16px);
    }

    .card{
      background:var(--card-surface,var(--surface));
      border-radius:16px;
      box-shadow:0 0 0 1px var(--border,#D5D8D2);
      padding:clamp(12px,2.4vw,18px);
      margin-bottom:clamp(14px,3vw,20px);
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:clamp(16px,2.8vw,20px);
    }
    .card p.sub{
      margin:0 0 10px 0;
      font-size:13px;
      color:var(--muted,#6B726C);
    }

    .field-row{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:10px;
    }
    .field-row label{
      font-size:13px;
      font-weight:500;
      color:var(--muted,#5E655F);
    }
    .field-row select,
    .field-row input[type="text"],
    .field-row textarea{
      border-radius:10px;
      border:1px solid var(--border,#D5D8D2);
      padding:8px 10px;
      font-size:14px;
      background:var(--input-bg,var(--surface));
      color:inherit;
    }
    .field-row textarea{
      min-height:70px;
      resize:vertical;
    }
    .field-row .readonly{
      border-radius:10px;
      padding:8px 10px;
      font-size:14px;
      background:var(--surface-soft,#F4F5F1);
      border:1px dashed var(--border,#D5D8D2);
      color:var(--muted,#5E655F);
    }

    .two-col{
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:640px){
      .two-col{ grid-template-columns:1fr; }
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:12px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:9px 16px;
      font-size:14px;
      font-weight:500;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      text-decoration:none;
    }
    .btn-primary{
      background:var(--accent,#3B7E46);
      color:#fff;
    }
    .btn-outline{
      background:transparent;
      color:var(--accent,#3B7E46);
      box-shadow:0 0 0 1px var(--accent,#3B7E46);
    }

    .small-note{
      font-size:12px;
      color:var(--muted,#747C74);
      margin-top:6px;
    }
  </style>
</head>
<body>
  <fv-shell>
    <div class="wrap">
      <header class="page">
        <h1>StarFire Location Update</h1>
        <p>Track where each StarFire globe is mounted, when it was moved, and who moved it.</p>
      </header>

      <!-- Select which StarFire receiver we’re working with -->
      <section class="card">
        <h2>Select StarFire Receiver</h2>
        <p class="sub">Choose a globe to view its current location and log a move.</p>

        <div class="field-row">
          <label for="starfireSelect">StarFire Receiver</label>
          <select id="starfireSelect">
            <option value="">Select a receiver…</option>
            <!-- TODO: populate from Firestore "equipment" where type=starfire -->
          </select>
          <div class="small-note">
            TODO: Load StarFire receivers from the database (e.g., equipment where <code>type="starfire"</code>).
          </div>
        </div>

        <div class="two-col">
          <div class="field-row">
            <label>Receiver ID / Name</label>
            <div id="sfName" class="readonly">—</div>
          </div>
          <div class="field-row">
            <label>Serial / JD Number</label>
            <div id="sfSerial" class="readonly">—</div>
          </div>
        </div>
      </section>

      <!-- Current / last-known location -->
      <section class="card">
        <h2>Current Location</h2>
        <p class="sub">Pulled from the last logged move for this receiver.</p>

        <div class="two-col">
          <div class="field-row">
            <label>Mounted On</label>
            <div id="currentEquipment" class="readonly">Not assigned</div>
          </div>
          <div class="field-row">
            <label>Last Moved</label>
            <div id="lastMovedAt" class="readonly">—</div>
          </div>
        </div>

        <div class="two-col">
          <div class="field-row">
            <label>Moved By</label>
            <div id="lastMovedBy" class="readonly">—</div>
          </div>
          <div class="field-row">
            <label>Last Notes</label>
            <div id="lastNotes" class="readonly">—</div>
          </div>
        </div>
      </section>

      <!-- Log a new move -->
      <section class="card">
        <h2>Log New Location</h2>
        <p class="sub">Record where this globe is going, who is moving it, and any notes.</p>

        <form id="moveForm">
          <div class="field-row">
            <label for="equipmentSelect">New Equipment Location</label>
            <select id="equipmentSelect" required>
              <option value="">Select equipment…</option>
              <!-- TODO: populate from equipment where gpsCapable == true and (status=active) -->
            </select>
            <div class="small-note">
              TODO: Load only equipment with GPS-capable slider ON (e.g., <code>gpsCapable = true</code>).
            </div>
          </div>

          <div class="two-col">
            <div class="field-row">
              <label for="movedBy">Moved By</label>
              <input id="movedBy" type="text" autocomplete="off" placeholder="Auto-fill from logged-in user" />
              <div class="small-note">
                TODO: Default to current FV user (e.g., from FVUserContext).
              </div>
            </div>

            <div class="field-row">
              <label for="movedAt">Move Date &amp; Time</label>
              <input id="movedAt" type="datetime-local"/>
              <div class="small-note">
                If left blank, you can default this to "now" in JS when saving.
              </div>
            </div>
          </div>

          <div class="field-row">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" placeholder="Example: moved from 8R tractor to S780 combine for fall strip-till."></textarea>
          </div>

          <div class="actions">
            <a class="btn btn-outline" href="/Farm-vista/pages/equipment/equipment-starfire.html">
              Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              Save Move
            </button>
          </div>
        </form>
      </section>
    </div>
  </fv-shell>

  <script>
    // Basic template wiring – no Firestore calls yet.
    // This is intentionally light so it doesn’t break anything.

    document.addEventListener('DOMContentLoaded', () => {
      const starfireSelect   = document.getElementById('starfireSelect');
      const equipmentSelect  = document.getElementById('equipmentSelect');
      const moveForm         = document.getElementById('moveForm');

      const sfName           = document.getElementById('sfName');
      const sfSerial         = document.getElementById('sfSerial');
      const currentEquipment = document.getElementById('currentEquipment');
      const lastMovedAt      = document.getElementById('lastMovedAt');
      const lastMovedBy      = document.getElementById('lastMovedBy');
      const lastNotes        = document.getElementById('lastNotes');

      const movedByInput     = document.getElementById('movedBy');
      const movedAtInput     = document.getElementById('movedAt');
      const notesInput       = document.getElementById('notes');

      // TODO: replace this with real data pulls.
      // For now, keep a simple in-memory example so the page "feels alive".
      const demoStarfires = [
        { id: 'sf-1', name: 'SF6000 #1', serial: 'JD-SF6000-001' },
        { id: 'sf-2', name: 'SF6000 #2', serial: 'JD-SF6000-002' }
      ];
      const demoEquipment = [
        { id: 'eq-8r',   label: '8R 370 – Tractor', gpsCapable: true },
        { id: 'eq-s780', label: 'S780 – Combine',   gpsCapable: true },
        { id: 'eq-6r',   label: '6R 155 – Tractor', gpsCapable: true }
      ];

      // Populate dropdowns (temp demo).
      demoStarfires.forEach(sf => {
        const opt = document.createElement('option');
        opt.value = sf.id;
        opt.textContent = sf.name;
        starfireSelect.appendChild(opt);
      });
      demoEquipment.forEach(eq => {
        const opt = document.createElement('option');
        opt.value = eq.id;
        opt.textContent = eq.label;
        equipmentSelect.appendChild(opt);
      });

      // When a StarFire receiver is picked, fake-fill the "current location" section.
      starfireSelect.addEventListener('change', () => {
        const id = starfireSelect.value;
        const sf = demoStarfires.find(x => x.id === id);
        if (!sf) {
          sfName.textContent = '—';
          sfSerial.textContent = '—';
          currentEquipment.textContent = 'Not assigned';
          lastMovedAt.textContent = '—';
          lastMovedBy.textContent = '—';
          lastNotes.textContent = '—';
          return;
        }

        sfName.textContent = sf.name;
        sfSerial.textContent = sf.serial;

        // TODO: load from Firestore move-history for this receiver.
        currentEquipment.textContent = 'Example: 8R 370 – Tractor';
        lastMovedAt.textContent = '2025-03-01 08:32';
        lastMovedBy.textContent = 'Dane K.';
        lastNotes.textContent = 'Moved from 6R to 8R for strip-till.';
      });

      moveForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const receiverId = starfireSelect.value;
        const equipmentId = equipmentSelect.value;

        if (!receiverId) {
          alert('Please select a StarFire receiver.');
          return;
        }
        if (!equipmentId) {
          alert('Please select new equipment.');
          return;
        }

        const payload = {
          receiverId,
          equipmentId,
          movedBy: movedByInput.value || '(auto-fill user later)',
          movedAt: movedAtInput.value || new Date().toISOString(),
          notes: notesInput.value || ''
        };

        console.log('TODO: Save StarFire move to Firestore:', payload);

        // TODO: replace with your toast system.
        alert('StarFire move saved (template only – wire to Firestore).');

        // Optionally redirect back to the StarFire hub.
        window.location.href = '/Farm-vista/pages/equipment/equipment-starfire.html';
      });
    });
  </script>
</body>
</html>
