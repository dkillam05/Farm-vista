<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista ‚Ä¢ Calculators</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <!-- PWA + icons -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>

  <!-- Early theme boot -->
  <script src="/Farm-vista/js/theme-boot.js"></script>

  <!-- Global CSS -->
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <!-- Shell -->
  <script src="/Farm-vista/js/fv-shell.js"></script>

  <!-- Try to load the tile component (fv-form-button). We hard-try a couple names. -->
  <script>
    (async () => {
      if (customElements.get('fv-form-button')) return;
      const candidates = [
        '/Farm-vista/js/form-button.js',
        '/Farm-vista/js/fv-form-button.js',
        '../../js/form-button.js',
        '../../js/fv-form-button.js'
      ];
      for (const src of candidates) {
        try {
          await new Promise((res, rej) => {
            const s = document.createElement('script');
            s.src = src; s.onload = res; s.onerror = rej; document.head.appendChild(s);
          });
          if (customElements.get('fv-form-button')) break;
        } catch {}
      }
      // Expose a flag for fallback rendering if still missing.
      window.__FV_FORM_BUTTON_READY__ = !!customElements.get('fv-form-button');
    })();
  </script>

  <style>
    :root{ --page-bottom-gap:56px; }
    body{ margin:0; }

    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:clamp(14px,3vw,22px);
      padding-bottom:calc(env(safe-area-inset-bottom,0px) + var(--ftr-h,42px) + var(--page-bottom-gap));
    }

    h1{ margin:8px 0 6px; font-size:clamp(22px,3.5vw,28px); line-height:1.2; font-weight:800; }
    p.lead{ margin:0 0 18px; color:var(--muted,#67706B); }

    /* Tile grid (same format as other index pages) */
    .form-tiles{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:clamp(10px,2.5vw,16px);
    }
    @media (min-width:980px){
      .form-tiles{ grid-template-columns:repeat(3, minmax(0,1fr)); }
    }

    /* Fallback tile (if component didn‚Äôt register) */
    .fallback-tile{
      display:grid; grid-template-rows:55% 45%; justify-items:center; align-items:center;
      height:160px; padding:18px; border-radius:16px;
      background:var(--card-surface, var(--surface)); color:var(--text);
      border:1px solid var(--card-border, var(--border)); box-shadow:var(--shadow);
      text-decoration:none; transition:transform .06s, box-shadow .12s, border-color .12s;
    }
    .fallback-tile:active{ transform:scale(.985); }
    .fallback-tile .label{ align-self:end; margin-bottom:32px; font-weight:800; font-size:clamp(18px,2.6vw,22px); color:var(--text); text-align:center; }
    .fallback-tile .icon{ align-self:start; transform:translateY(-10px); font-size:clamp(40px,10vw,60px); line-height:1; }
  </style>
</head>
<body>
  <fv-shell>
    <div class="wrap">
      <h1>Calculators</h1>
      <p class="lead">Quick tools for field and grain math. Your last 10 runs are saved locally on each calculator page.</p>

      <section class="form-tiles" id="tiles">
        <!-- If fv-form-button is ready, these render; otherwise we‚Äôll inject fallback tiles below -->
        <fv-form-button label="Area"                         icon="üìê" href="/Farm-vista/pages/calculators/calc-area.html"></fv-form-button>
        <fv-form-button label="Grain Bin"                    icon="üõ¢Ô∏è" href="/Farm-vista/pages/calculators/calc-grain-bin.html"></fv-form-button>
        <fv-form-button label="Grain Shrink"                 icon="üìâ" href="/Farm-vista/pages/calculators/calc-grain-shrink.html"></fv-form-button>
        <fv-form-button label="Combine Grain Loss"           icon="üåæ" href="/Farm-vista/pages/calculators/calc-combine-grain-loss.html"></fv-form-button>
        <fv-form-button label="Combine Yield Check"          icon="‚úÖ" href="/Farm-vista/pages/calculators/calc-combine-yield.html"></fv-form-button>
        <fv-form-button label="Combine Yield Calibration"    icon="‚öñÔ∏è" href="/Farm-vista/pages/calculators/calc-combine-yield-calibration.html"></fv-form-button>
        <fv-form-button label="Chemical Mix"                 icon="üß™" href="/Farm-vista/pages/calculators/calc-chemical-mix.html"></fv-form-button>
        <fv-form-button label="Trial Yields"                 icon="üß¨" href="/Farm-vista/pages/calculators/calc-trial-yields.html"></fv-form-button>
      </section>
    </div>
  </fv-shell>

  <!-- Fallback renderer: if component isn‚Äôt registered after load, draw tiles as links -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const ok = window.__FV_FORM_BUTTON_READY__ || customElements.get('fv-form-button');
      if (ok) return;

      const data = [
        {label:'Area', href:'/Farm-vista/pages/calculators/calc-area.html', icon:'üìê'},
        {label:'Grain Bin', href:'/Farm-vista/pages/calculators/calc-grain-bin.html', icon:'üõ¢Ô∏è'},
        {label:'Grain Shrink', href:'/Farm-vista/pages/calculators/calc-grain-shrink.html', icon:'üìâ'},
        {label:'Combine Grain Loss', href:'/Farm-vista/pages/calculators/calc-combine-grain-loss.html', icon:'üåæ'},
        {label:'Combine Yield Check', href:'/Farm-vista/pages/calculators/calc-combine-yield.html', icon:'‚úÖ'},
        {label:'Combine Yield Calibration', href:'/Farm-vista/pages/calculators/calc-combine-yield-calibration.html', icon:'‚öñÔ∏è'},
        {label:'Chemical Mix', href:'/Farm-vista/pages/calculators/calc-chemical-mix.html', icon:'üß™'},
        {label:'Trial Yields', href:'/Farm-vista/pages/calculators/calc-trial-yields.html', icon:'üß¨'}
      ];

      const tiles = document.getElementById('tiles');
      tiles.innerHTML = '';
      for (const t of data) {
        const a = document.createElement('a');
        a.className = 'fallback-tile';
        a.href = t.href;
        a.innerHTML = `<div class="label">${t.label}</div><div class="icon">${t.icon}</div>`;
        tiles.appendChild(a);
      }
    });
  </script>
</body>
</html>