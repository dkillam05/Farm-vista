<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FarmVista • Expense Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#3B7E46" />

  <!-- App includes (consistent across the site) -->
  <link rel="manifest" href="/Farm-vista/manifest.webmanifest" />
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png" />
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png" />
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css" />
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css" />
  <script defer src="/Farm-vista/js/fv-combo.js"></script>

  <style>
    /* ---------- Tile page layout ---------- */
    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: clamp(14px, 3vw, 22px);
      padding-bottom: calc(env(safe-area-inset-bottom, 0px) + var(--ftr-h, 42px) + 96px) !important;
    }

    .page-title {
      margin: 0 0 4px 0;
    }

    .page-sub {
      margin: 0 0 16px 0;
      color: var(--muted, #67706B);
      font-size: 0.95rem;
    }

    .filter-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .year-filter {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
      color: var(--muted, #67706B);
    }

    .year-filter label {
      font-weight: 500;
    }

    .year-filter select {
      min-width: 120px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle, #D3D7D4);
      background: var(--surface, #FFFFFF);
      font: inherit;
    }

    .section {
      border: 1px solid var(--border);
      border-radius: 14px;
      background: var(--surface);
      box-shadow: var(--shadow, 0 8px 20px rgba(0, 0, 0, .08));
      overflow: hidden;
    }

    .section-head {
      display: grid;
      grid-template-columns: 36px 1fr;
      gap: 12px;
      align-items: center;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(90deg, rgba(47, 108, 60, .12), transparent);
    }

    .section-head .icon {
      width: 24px;
      height: 24px;
      color: #2F6C3C;
      display: grid;
      place-items: center;
    }

    .section-head-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .section-head-title strong {
      font-size: 0.98rem;
    }

    .section-head-title span {
      font-size: 0.82rem;
      color: var(--muted, #67706B);
    }

    .section-body {
      padding: 16px;
    }

    .month-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (min-width: 700px) {
      .month-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (min-width: 960px) {
      .month-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    .month-card {
      border: 1px solid var(--border-subtle, #D3D7D4);
      border-radius: 14px;
      background: var(--surface-elevated, #FFFFFF);
      padding: 12px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: var(--shadow-soft, 0 6px 16px rgba(0, 0, 0, .04));
      cursor: pointer;
      transition:
        transform 0.12s ease,
        box-shadow 0.12s ease,
        border-color 0.12s ease,
        background 0.12s ease;
    }

    .month-card:hover {
      transform: translateY(-1px);
      border-color: rgba(47, 108, 60, 0.4);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.10);
      background: linear-gradient(135deg, rgba(47, 108, 60, 0.04), rgba(255, 255, 255, 0.96));
    }

    .month-avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(47, 108, 60, 0.35);
      background: radial-gradient(circle at 30% 0%, rgba(255, 255, 255, 0.9), rgba(47, 108, 60, 0.12));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #2F6C3C;
      flex-shrink: 0;
    }

    .month-text-main {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .month-text-sub {
      font-size: 0.8rem;
      color: var(--muted, #67706B);
    }

    .month-card-inner {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    /* ---------- PRINT REPORT LAYOUT (hidden on screen) ---------- */
    .report-root {
      display: none;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #111827;
      background: #fff;
    }

    .report-root .report-header{
      display:grid;
      grid-template-columns:auto 1fr auto;
      gap:16px;
      align-items:center;
      border-bottom:2px solid #3B7E46;
      padding-bottom:14px;
      margin-bottom:18px;
    }

    .report-root .report-logo{
      width:64px;
      height:64px;
      border-radius:16px;
      border:1px solid #D1D5DB;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:26px;
      font-weight:800;
      color:#fff;
      background:radial-gradient(circle at 30% 0%, #4CAF50, #3B7E46);
    }
    .report-root .report-logo span{
      letter-spacing:0.02em;
    }

    .report-root .company-block{
      min-width:0;
    }
    .report-root .company-name{
      font-size:18px;
      font-weight:800;
      margin:0 0 2px;
    }
    .report-root .company-line{
      font-size:12px;
      color:#6B7280;
      margin:0;
      white-space:pre-line;
    }

    .report-root .report-meta-top{
      text-align:right;
      font-size:11px;
      color:#6B7280;
    }
    .report-root .report-meta-top strong{
      color:#111827;
    }

    .report-root .report-title-block{
      margin-bottom:16px;
    }

    .report-root .report-title{
      font-size:20px;
      font-weight:800;
      margin:4px 0 4px;
      letter-spacing:0.02em;
      text-transform:uppercase;
    }

    .report-root .report-subtitle{
      font-size:13px;
      color:#6B7280;
      margin:0;
    }

    .report-root .report-summary-strip{
      margin-top:12px;
      padding:8px 10px;
      border-radius:10px;
      background:linear-gradient(90deg, rgba(59,126,70,0.08), transparent);
      border:1px solid rgba(59,126,70,0.20);
      font-size:11px;
      display:flex;
      flex-wrap:wrap;
      gap:6px 16px;
    }
    .report-root .summary-pill{
      display:inline-flex;
      align-items:center;
      gap:4px;
      white-space:nowrap;
    }
    .report-root .summary-label{
      text-transform:uppercase;
      letter-spacing:0.08em;
      font-weight:600;
      font-size:10px;
      color:#6B7280;
    }
    .report-root .summary-value{
      font-weight:600;
      font-size:11px;
    }

    .report-root .section{
      margin-top:18px;
    }
    .report-root .section-title{
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:#6B7280;
      margin:0 0 4px;
    }
    .report-root .section-heading-row{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }
    .report-root .section-heading-row .section-title-main{
      font-size:15px;
      font-weight:700;
      letter-spacing:0.03em;
      text-transform:uppercase;
    }
    .report-root .section-heading-row .section-note{
      font-size:11px;
      color:#6B7280;
    }

    .report-root .section-body{
      font-size:12px;
      line-height:1.5;
    }

    .report-root .table-wrap{
      margin-top:6px;
      border-radius:10px;
      border:1px solid #D1D5DB;
      overflow:hidden;
    }

    .report-root table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
    }

    .report-root thead{
      background:#F9FAFB;
    }

    .report-root th,
    .report-root td{
      padding:6px 8px;
      border-bottom:1px solid #E5E7EB;
      text-align:left;
      vertical-align:top;
    }

    .report-root th{
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.08em;
      font-size:10px;
      color:#4B5563;
      border-bottom:1px solid #D1D5DB;
    }

    .report-root tr:nth-child(even) td{
      background:#F9FAFB;
    }

    .report-root .cell-right{ text-align:right; }
    .report-root .cell-center{ text-align:center; }
    .report-root .cell-muted{ color:#6B7280; }

    .report-root .kpi-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:6px;
    }

    .report-root .kpi-card{
      flex:1 1 140px;
      border-radius:10px;
      border:1px solid #D1D5DB;
      padding:8px 10px;
      background:linear-gradient(135deg, rgba(59,126,70,0.06), #ffffff);
    }
    .report-root .kpi-label{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.08em;
      color:#6B7280;
      margin-bottom:2px;
    }
    .report-root .kpi-value{
      font-size:16px;
      font-weight:800;
    }
    .report-root .kpi-footnote{
      font-size:10px;
      color:#6B7280;
      margin-top:2px;
    }

    .report-root .receipt-item{
      margin:8px 0 12px;
      font-size:11px;
    }
    .report-root .receipt-caption{
      color:#6B7280;
      margin-bottom:3px;
    }
    .report-root .receipt-image{
      max-width:100%;
      max-height:420px;
      border-radius:6px;
      border:1px solid #E5E7EB;
      display:block;
    }

    .report-root .report-footer{
      margin-top:18px;
      padding-top:8px;
      border-top:1px solid #D1D5DB;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:10px;
      color:#6B7280;
    }
    .report-root .footer-left{
      max-width:60%;
    }
    .report-root .footer-right{
      text-align:right;
    }

    /* ---------- Print behavior ---------- */
    @media print {
      body{
        background:#fff;
        padding:0;
      }

      /* Hide the interactive tile UI when printing */
      .page.container{
        display:none !important;
      }

      .report-root{
        display:block;
        width:100%;
        max-width:900px;
        margin:0 auto;
        padding:12mm 14mm;
        box-shadow:none;
      }
    }
  </style>

  <script>
    // Load <fv-shell> if needed
    (function () {
      if (!customElements.get('fv-shell')) {
        const s = document.createElement('script');
        s.src = '/Farm-vista/js/fv-shell.js';
        s.defer = true;
        document.head.appendChild(s);
      }
    })();

    // Global helper to set text
    function setText(id, value) {
      var el = document.getElementById(id);
      if (el) el.textContent = value || '';
    }

    // Build FV_REPORT_DATA for a given year/month
    function buildBaseReportData(year, monthNumber) {
      // monthNumber: 1–12
      var monthIndex = monthNumber - 1;
      var monthNames = [
        'January','February','March','April','May','June',
        'July','August','September','October','November','December'
      ];

      var monthLabel = 'This Period';
      var dateRange = '';

      if (year && monthIndex >= 0 && monthIndex < 12) {
        var mName = monthNames[monthIndex];
        monthLabel = mName + ' ' + year;

        var start = new Date(year, monthIndex, 1);
        var end = new Date(year, monthIndex + 1, 0);

        function fmt(d){
          var shortNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
          return shortNames[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
        }

        dateRange = fmt(start) + ' – ' + fmt(end);
      }

      var now = new Date();
      var runDateLocal = now.toISOString().slice(0,10);

      window.FV_REPORT_DATA = window.FV_REPORT_DATA || {};

      // Company defaults (can be overridden later)
      window.FV_REPORT_DATA.company = Object.assign({
        name: 'Dowson Farms',
        street: '',
        city: 'Divernon',
        state: 'IL',
        zip: '',
        phone: '',
        email: ''
      }, window.FV_REPORT_DATA.company || {});

      // Meta defaults using month/year from click
      window.FV_REPORT_DATA.meta = Object.assign({
        reportTitleShort: 'Monthly Expenses',
        reportTitle: 'Monthly Expense Report',
        reportSubtitle: 'Summary of farm expenditures for ' + monthLabel,
        runDateTime: now.toLocaleString('en-US', {
          year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        }),
        preparedBy: '',
        monthLabel: monthLabel,
        dateRange: dateRange || monthLabel,
        filterSummary: 'All farms · All categories',
        footerLeftText: 'Internal management report. For farm records only.',
        footerRightText: 'Monthly Expenses',
        runDate: runDateLocal
      }, window.FV_REPORT_DATA.meta || {});

      // Ensure arrays exist; you can overwrite with real data later
      if (!Array.isArray(window.FV_REPORT_DATA.expenses)) {
        window.FV_REPORT_DATA.expenses = [];
      }
      if (!Array.isArray(window.FV_REPORT_DATA.categories)) {
        window.FV_REPORT_DATA.categories = [];
      }
      window.FV_REPORT_DATA.kpis = window.FV_REPORT_DATA.kpis || {};
    }

    // Render the report DOM from FV_REPORT_DATA
    function renderReportFromData() {
      var data = window.FV_REPORT_DATA || {};
      var company = data.company || {};
      var meta = data.meta || {};
      var kpis = data.kpis || {};
      var expenses = Array.isArray(data.expenses) ? data.expenses : [];
      var categories = Array.isArray(data.categories) ? data.categories : [];

      // Header / company
      var companyLineParts = [
        company.street,
        (company.city && company.state) ? (company.city + ', ' + company.state) : (company.city || company.state),
        company.zip
      ].filter(Boolean);

      var contactParts = [];
      if (company.phone) contactParts.push('Phone: ' + company.phone);
      if (company.email) contactParts.push('Email: ' + company.email);
      if (contactParts.length) {
        companyLineParts.push(contactParts.join(' · '));
      }

      setText('companyName', company.name || '');
      setText('companyLine', companyLineParts.join('\n'));

      // Meta
      setText('reportTitleShort', meta.reportTitleShort || 'Monthly Expenses');
      setText('reportTitle', meta.reportTitle || 'Monthly Expense Report');
      setText('reportSubtitle', meta.reportSubtitle || '');
      setText('runDateTime', meta.runDateTime || '');
      setText('preparedBy', meta.preparedBy || '');
      setText('monthLabel', meta.monthLabel || '');
      setText('dateRange', meta.dateRange || '');
      setText('filterSummary', meta.filterSummary || 'No additional filters');
      setText('expenseCount', String(expenses.length || 0));

      // KPIs
      setText('kpiNote', kpis.note || 'All figures in USD.');
      setText('kpiTotalSpend', kpis.totalSpendFormatted || (expenses.length ? '—' : '$0.00'));
      setText('kpiAvgPerDay', kpis.avgPerDayFormatted || (expenses.length ? '—' : '$0.00'));
      setText('kpiTopCategory', kpis.topCategoryLabel || (expenses.length ? '—' : 'None'));

      // Detail intro text
      if (expenses.length) {
        setText('detailIntroText', 'Detailed list of all recorded expenditures for ' + (meta.monthLabel || 'this period') + '.');
      } else {
        setText('detailIntroText', 'No expenditures were recorded for ' + (meta.monthLabel || 'this period') + '.');
      }

      // Category section text
      setText('section2Note', expenses.length ? 'Breakdown of spending by category.' : 'No category data available (no expenditures).');
      if (expenses.length) {
        setText('section2BodyText', 'Categories ranked by total dollars spent for ' + (meta.monthLabel || 'this period') + '.');
      } else {
        setText('section2BodyText', 'No expenditures were recorded, so there is no category breakdown to display.');
      }

      // Footer
      setText('footerLeftText', meta.footerLeftText || '');
      setText('footerRightText', meta.footerRightText || 'Monthly Expenses');
      setText('runDate', meta.runDate || '');

      // Expense table
      var expenseBody = document.getElementById('expenseTableBody');
      if (expenseBody) {
        expenseBody.innerHTML = '';
        if (!expenses.length) {
          var tr = document.createElement('tr');
          var td = document.createElement('td');
          td.colSpan = 6;
          td.className = 'cell-center cell-muted';
          td.textContent = 'No expenditures recorded for ' + (meta.monthLabel || 'this period') + '.';
          tr.appendChild(td);
          expenseBody.appendChild(tr);
        } else {
          expenses.forEach(function (e) {
            var tr = document.createElement('tr');

            var tdDate = document.createElement('td');
            tdDate.textContent = e.date || '';
            tr.appendChild(tdDate);

            var tdVendor = document.createElement('td');
            tdVendor.textContent = e.vendor || '';
            tr.appendChild(tdVendor);

            var tdCat = document.createElement('td');
            tdCat.textContent = e.category || '';
            tr.appendChild(tdCat);

            var tdMethod = document.createElement('td');
            tdMethod.textContent = e.method || '';
            tr.appendChild(tdMethod);

            var tdAmt = document.createElement('td');
            tdAmt.className = 'cell-right';
            tdAmt.textContent = e.amountFormatted || '';
            tr.appendChild(tdAmt);

            var tdNotes = document.createElement('td');
            tdNotes.textContent = e.notes || '';
            tr.appendChild(tdNotes);

            expenseBody.appendChild(tr);
          });
        }
      }

      // Category table
      var catBody = document.getElementById('categoryTableBody');
      if (catBody) {
        catBody.innerHTML = '';
        if (!categories.length) {
          var trc = document.createElement('tr');
          var tdc = document.createElement('td');
          tdc.colSpan = 4;
          tdc.className = 'cell-center cell-muted';
          tdc.textContent = expenses.length
            ? 'No category breakdown available.'
            : 'No expenditures recorded, so there is no category breakdown.';
          trc.appendChild(tdc);
          catBody.appendChild(trc);
        } else {
          categories.forEach(function (c) {
            var tr = document.createElement('tr');

            var tdCatName = document.createElement('td');
            tdCatName.textContent = c.category || '';
            tr.appendChild(tdCatName);

            var tdTotal = document.createElement('td');
            tdTotal.className = 'cell-right';
            tdTotal.textContent = c.totalFormatted || '';
            tr.appendChild(tdTotal);

            var tdPct = document.createElement('td');
            tdPct.className = 'cell-center';
            tdPct.textContent = c.pctFormatted || '';
            tr.appendChild(tdPct);

            var tdNotes = document.createElement('td');
            tdNotes.textContent = c.notes || '';
            tr.appendChild(tdNotes);

            catBody.appendChild(tr);
          });
        }
      }

      // Receipt gallery from expenses.receiptUrls
      var gallery = document.getElementById('receiptGallery');
      if (gallery) {
        gallery.innerHTML = '';
        var anyReceipts = false;

        expenses.forEach(function (e) {
          var urls = Array.isArray(e.receiptUrls) ? e.receiptUrls : [];
          urls.forEach(function (url) {
            if (!url) return;
            anyReceipts = true;
            var wrap = document.createElement('div');
            wrap.className = 'receipt-item';

            var cap = document.createElement('div');
            cap.className = 'receipt-caption';
            var captionParts = [];
            if (e.date) captionParts.push(e.date);
            if (e.vendor) captionParts.push(e.vendor);
            if (e.amountFormatted) captionParts.push(e.amountFormatted);
            cap.textContent = captionParts.join(' • ') || 'Receipt';
            wrap.appendChild(cap);

            var img = document.createElement('img');
            img.className = 'receipt-image';
            img.src = url;
            img.alt = 'Receipt image';
            wrap.appendChild(img);

            gallery.appendChild(wrap);
          });
        });

        if (!anyReceipts) {
          var p = document.createElement('p');
          p.className = 'cell-muted';
          p.style.fontSize = '11px';
          p.textContent = 'No receipt images saved for this month.';
          gallery.appendChild(p);
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const yearSelect = document.getElementById('reportYear');
      const grid = document.querySelector('[data-month-grid]');

      function populateYears() {
        if (!yearSelect) return;
        const now = new Date();
        const currentYear = now.getFullYear();
        const years = [currentYear, currentYear - 1, currentYear - 2];

        years.forEach((year, idx) => {
          const opt = document.createElement('option');
          opt.value = String(year);
          opt.textContent = String(year);
          if (idx === 0) opt.selected = true;
          yearSelect.appendChild(opt);
        });
      }

      function handleMonthClick(evt) {
        const card = evt.target.closest('[data-month]');
        if (!card) return;
        const year = yearSelect ? yearSelect.value : '';
        const monthStr = card.getAttribute('data-month');
        if (!year || !monthStr) return;

        const yearNum = parseInt(year, 10);
        const monthNum = parseInt(monthStr, 10); // 1–12

        // 1) Build base report data for this month
        buildBaseReportData(yearNum, monthNum);

        // 2) (Later) you can fetch Firestore data here and fill FV_REPORT_DATA.expenses/categories

        // 3) Render the report DOM
        renderReportFromData();

        // 4) Open the print dialog
        setTimeout(function () {
          window.focus();
          window.print();
        }, 300);
      }

      populateYears();
      if (grid) {
        grid.addEventListener('click', handleMonthClick);
      }
    });
  </script>
</head>
<body>
  <fv-shell>
    <!-- TILE UI (screen only) -->
    <div class="page container">
      <h1 class="page-title">Expense Reports</h1>
      <p class="page-sub">
        Tap a month to open the detailed expenditures report for that period. Use the year filter to jump between years.
      </p>

      <div class="filter-row">
        <div></div>
        <div class="year-filter">
          <label for="reportYear">Year</label>
          <select id="reportYear" name="reportYear" data-fv-combo="true"></select>
        </div>
      </div>

      <section class="section" aria-label="Monthly expense reports">
        <header class="section-head">
          <div class="icon" aria-hidden="true">
            <!-- simple report icon -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M9 3h6l4 4v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2z" />
              <path d="M14 3v4a2 2 0 0 0 2 2h4" />
              <path d="M9 13h6" />
              <path d="M9 17h3" />
            </svg>
          </div>
          <div class="section-head-title">
            <strong>Monthly Expense Reports</strong>
            <span>One report per month for the selected year.</span>
          </div>
        </header>

        <div class="section-body">
          <div class="month-grid" data-month-grid>
            <!-- Jan -->
            <article class="month-card" data-month="01">
              <div class="month-avatar">JAN</div>
              <div class="month-card-inner">
                <div class="month-text-main">January</div>
                <div class="month-text-sub">Tap to print January expenses.</div>
              </div>
            </article>

            <!-- Feb -->
            <article class="month-card" data-month="02">
              <div class="month-avatar">FEB</div>
              <div class="month-card-inner">
                <div class="month-text-main">February</div>
                <div class="month-text-sub">Tap to print February expenses.</div>
              </div>
            </article>

            <!-- Mar -->
            <article class="month-card" data-month="03">
              <div class="month-avatar">MAR</div>
              <div class="month-card-inner">
                <div class="month-text-main">March</div>
                <div class="month-text-sub">Tap to print March expenses.</div>
              </div>
            </article>

            <!-- Apr -->
            <article class="month-card" data-month="04">
              <div class="month-avatar">APR</div>
              <div class="month-card-inner">
                <div class="month-text-main">April</div>
                <div class="month-text-sub">Tap to print April expenses.</div>
              </div>
            </article>

            <!-- May -->
            <article class="month-card" data-month="05">
              <div class="month-avatar">MAY</div>
              <div class="month-card-inner">
                <div class="month-text-main">May</div>
                <div class="month-text-sub">Tap to print May expenses.</div>
              </div>
            </article>

            <!-- Jun -->
            <article class="month-card" data-month="06">
              <div class="month-avatar">JUN</div>
              <div class="month-card-inner">
                <div class="month-text-main">June</div>
                <div class="month-text-sub">Tap to print June expenses.</div>
              </div>
            </article>

            <!-- Jul -->
            <article class="month-card" data-month="07">
              <div class="month-avatar">JUL</div>
              <div class="month-card-inner">
                <div class="month-text-main">July</div>
                <div class="month-text-sub">Tap to print July expenses.</div>
              </div>
            </article>

            <!-- Aug -->
            <article class="month-card" data-month="08">
              <div class="month-avatar">AUG</div>
              <div class="month-card-inner">
                <div class="month-text-main">August</div>
                <div class="month-text-sub">Tap to print August expenses.</div>
              </div>
            </article>

            <!-- Sep -->
            <article class="month-card" data-month="09">
              <div class="month-avatar">SEP</div>
              <div class="month-card-inner">
                <div class="month-text-main">September</div>
                <div class="month-text-sub">Tap to print September expenses.</div>
              </div>
            </article>

            <!-- Oct -->
            <article class="month-card" data-month="10">
              <div class="month-avatar">OCT</div>
              <div class="month-card-inner">
                <div class="month-text-main">October</div>
                <div class="month-text-sub">Tap to print October expenses.</div>
              </div>
            </article>

            <!-- Nov -->
            <article class="month-card" data-month="11">
              <div class="month-avatar">NOV</div>
              <div class="month-card-inner">
                <div class="month-text-main">November</div>
                <div class="month-text-sub">Tap to print November expenses.</div>
              </div>
            </article>

            <!-- Dec -->
            <article class="month-card" data-month="12">
              <div class="month-avatar">DEC</div>
              <div class="month-card-inner">
                <div class="month-text-main">December</div>
                <div class="month-text-sub">Tap to print December expenses.</div>
              </div>
            </article>
          </div>
        </div>
      </section>
    </div>

    <!-- HIDDEN REPORT TEMPLATE (only shows in print) -->
    <div id="printReport" class="report-root" aria-hidden="true">
      <!-- HEADER -->
      <header class="report-header">
        <div class="report-logo">
          <span>DF</span>
        </div>

        <div class="company-block">
          <p class="company-name" id="companyName"></p>
          <p class="company-line" id="companyLine"></p>
        </div>

        <div class="report-meta-top">
          <div><strong id="reportTitleShort"></strong></div>
          <div>Generated: <span id="runDateTime"></span></div>
          <div>Prepared by: <span id="preparedBy"></span></div>
        </div>
      </header>

      <!-- TITLE + SUMMARY -->
      <section class="report-title-block">
        <h1 class="report-title" id="reportTitle"></h1>
        <p class="report-subtitle" id="reportSubtitle"></p>

        <div class="report-summary-strip">
          <div class="summary-pill">
            <span class="summary-label">Month</span>
            <span class="summary-value" id="monthLabel"></span>
          </div>
          <div class="summary-pill">
            <span class="summary-label">Date range</span>
            <span class="summary-value" id="dateRange"></span>
          </div>
          <div class="summary-pill">
            <span class="summary-label">Filters</span>
            <span class="summary-value" id="filterSummary"></span>
          </div>
          <div class="summary-pill">
            <span class="summary-label">Expenses</span>
            <span class="summary-value" id="expenseCount"></span>
          </div>
        </div>
      </section>

      <!-- KEY METRICS -->
      <section class="section">
        <div class="section-heading-row">
          <div class="section-title-main">Key Metrics</div>
          <div class="section-note" id="kpiNote"></div>
        </div>
        <div class="kpi-row">
          <div class="kpi-card">
            <div class="kpi-label">Total Spend</div>
            <div class="kpi-value" id="kpiTotalSpend"></div>
            <div class="kpi-footnote">Total expenses recorded for this month</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Average Per Day</div>
            <div class="kpi-value" id="kpiAvgPerDay"></div>
            <div class="kpi-footnote">Average daily spend across the selected date range</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Largest Category</div>
            <div class="kpi-value" id="kpiTopCategory"></div>
            <div class="kpi-footnote">Category with the highest total spend</div>
          </div>
        </div>
      </section>

      <!-- MAIN TABLE SECTION -->
      <section class="section">
        <h2 class="section-title">Detail</h2>
        <div class="section-body">
          <p id="detailIntroText"></p>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Vendor / Merchant</th>
                  <th>Category</th>
                  <th>Payment Method</th>
                  <th class="cell-right">Amount</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody id="expenseTableBody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CATEGORY BREAKDOWN -->
      <section class="section">
        <div class="section-heading-row">
          <div class="section-title-main">Category Breakdown</div>
          <div class="section-note" id="section2Note"></div>
        </div>
        <div class="section-body">
          <p id="section2BodyText"></p>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Category</th>
                  <th class="cell-right">Total Amount</th>
                  <th class="cell-center">% of Month Total</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody id="categoryTableBody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RECEIPT IMAGES -->
      <section class="section">
        <div class="section-heading-row">
          <div class="section-title-main">Receipt Images</div>
          <div class="section-note">Saved attachments for this month</div>
        </div>
        <div class="section-body" id="receiptGallery">
          <!-- Populated by JS -->
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="report-footer">
        <div class="footer-left" id="footerLeftText"></div>
        <div class="footer-right">
          FarmVista • <span id="footerRightText"></span> • <span id="runDate"></span>
        </div>
      </footer>
    </div>
  </fv-shell>
</body>
</html>
