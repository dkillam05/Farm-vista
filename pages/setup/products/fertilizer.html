<!doctype html><html lang="en"><head>
  <meta charset="utf-8"/>
  <title>FarmVista • Setup → Products → Fertilizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>
  <script src="/Farm-vista/js/theme-boot.js"></script>
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <style>
    .section{border:1px solid var(--border); border-radius:14px; background:var(--surface); box-shadow:var(--shadow,0 8px 20px rgba(0,0,0,.08));}
    .section-head{display:grid; grid-template-columns:36px 1fr; gap:12px; align-items:center; padding:14px 16px; border-bottom:1px solid var(--border); background:linear-gradient(90deg, rgba(47,108,60,.12), transparent);}
    .section-head .icon{width:24px; height:24px; color:#2F6C3C; display:grid; place-items:center;}
    .section-body{padding:16px; display:grid; gap:14px;}
    .grid-2{display:grid; gap:10px; grid-template-columns:1fr 1fr;}
    .grid-3{display:grid; gap:10px; grid-template-columns:1fr 1fr 1fr;}
    @media(max-width:880px){ .grid-2, .grid-3 { grid-template-columns:1fr; } }
    .field label{display:block; font-weight:800; margin:0 0 6px 0;}
    .input,.select,.textarea{width:100%; font:inherit; font-size:16px; color:var(--text); background:var(--card-surface,var(--surface)); border:1px solid var(--border); border-radius:10px; padding:12px; outline:none;}
    .textarea{min-height:96px; resize:vertical;}
    .help{font-size:13px; color:var(--muted,#67706B);}
    .actions{display:flex; gap:12px; flex-wrap:wrap}
    .btn{display:inline-flex; align-items:center; justify-content:center; min-width:148px; padding:12px 16px; border-radius:12px; border:1px solid var(--border); background:var(--card-surface,var(--surface)); font-weight:800; color:var(--text); cursor:pointer;}
    .btn-primary{border-color:transparent; background:#2F6C3C; color:#fff;}
    .toast{position:fixed; left:50%; bottom:calc(env(safe-area-inset-bottom,0px) + 72px); transform:translateX(-50%); background:#2F6C3C; color:#fff; padding:10px 14px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,.25); z-index:99999; display:none;}
    .toast.show{display:block; animation:fadeout 2.8s forwards;}
    @keyframes fadeout{0%{opacity:1} 85%{opacity:1} 100%{opacity:0}}
    .page{max-width:1100px; margin:0 auto; padding:clamp(14px,3vw,22px); padding-bottom:calc(env(safe-area-inset-bottom,0px) + var(--ftr-h,42px) + 96px)!important;}
    .page-title{margin:0 0 8px 0;}
    .page-sub{margin:0 0 14px 0; color:var(--muted,#67706B);}
  </style>

  <script>(function(){ if(!customElements.get('fv-shell')){ const s=document.createElement('script'); s.src='/Farm-vista/js/fv-shell.js'; s.defer=true; document.head.appendChild(s);} })();</script>
</head><body>
  <fv-shell>
    <div class="page container">
      <h1 class="page-title">Fertilizer Setup</h1>
      <p class="page-sub">Add fertilizer products with analysis, source, units, and density to support purchasing and application reports.</p>

      <section class="section">
        <header class="section-head">
          <div class="icon" aria-hidden="true">
            <!-- fertilizer/leaf icon -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22s8-4 8-10a8 8 0 1 0 -16 0c0 6 8 10 8 10z"/><path d="M12 14v-8m-3 3l6 0"/>
            </svg>
          </div>
          <div>
            <strong>New Fertilizer Product</strong>
            <div class="help">Enter grade (N-P₂O₅-K₂O) and source; add optional micros and unit conversions.</div>
          </div>
        </header>

        <div class="section-body">
          <div class="grid-3">
            <div class="field">
              <label for="vendor">Vendor (optional)</label>
              <input id="vendor" class="input" placeholder="e.g., Nutrien, local co-op">
            </div>
            <div class="field">
              <label for="source">Source</label>
              <select id="source" class="select">
                <option value="">—</option>
                <option>Urea (46-0-0)</option>
                <option>UAN 28 (28-0-0)</option>
                <option>UAN 32 (32-0-0)</option>
                <option>Anhydrous Ammonia (82-0-0)</option>
                <option>AMS (21-0-0-24S)</option>
                <option>ATS (12-0-0-26S)</option>
                <option>MAP (11-52-0)</option>
                <option>DAP (18-46-0)</option>
                <option>Potash MOP (0-0-60)</option>
                <option>SOP (0-0-50-18S)</option>
                <option>K-Mag (0-0-22-22S-11Mg)</option>
                <option>Gypsum (CaSO₄·2H₂O)</option>
                <option>Other</option>
              </select>
            </div>
            <div class="field">
              <label for="form">Form</label>
              <select id="form" class="select">
                <option>Dry</option>
                <option>Liquid</option>
                <option>Gas (NH₃)</option>
              </select>
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label for="n">Analysis N-P₂O₅-K₂O</label>
              <div class="grid-3">
                <input id="n"  class="input" inputmode="decimal" placeholder="N %">
                <input id="p"  class="input" inputmode="decimal" placeholder="P₂O₅ %">
                <input id="k"  class="input" inputmode="decimal" placeholder="K₂O %">
              </div>
            </div>
            <div class="field">
              <label for="micros">Micronutrients (optional)</label>
              <input id="micros" class="input" placeholder="e.g., 10% S, 2% Zn, 1% B">
            </div>
            <div class="field">
              <label for="density">Density (liquid only)</label>
              <div class="grid-2">
                <input id="density" class="input" inputmode="decimal" placeholder="lb/gal">
                <select id="densUnit" class="select"><option>lb/gal</option><option>g/mL</option></select>
              </div>
              <div class="help">Needed for gal↔lb conversions in mixes.</div>
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label for="purchaseUnit">Purchase Unit</label>
              <select id="purchaseUnit" class="select">
                <option>ton</option><option>lb</option><option>gal</option><option>tote</option><option>truckload</option>
              </select>
            </div>
            <div class="field">
              <label for="appliedUnit">Applied Unit</label>
              <select id="appliedUnit" class="select">
                <option>lb/ac</option><option>gal/ac</option><option>cwt/ac</option>
              </select>
            </div>
            <div class="field">
              <label for="notes">Notes</label>
              <input id="notes" class="input" placeholder="Salt index, placement notes, restrictions…">
            </div>
          </div>

          <div class="actions">
            <button id="clear" class="btn" type="button">Clear</button>
            <button id="save" class="btn btn-primary" type="button">Save Fertilizer</button>
          </div>
        </div>
      </section>
    </div>
  </fv-shell>

  <div id="toast" class="toast" role="status" aria-live="polite">Saved.</div>

  <script>
  (function(){
    "use strict";
    const $=id=>document.getElementById(id);
    const STORAGE_KEY="fv_fert_products_v1";
    const toast=$("toast");
    function showToast(m="Saved."){ toast.textContent=m; toast.classList.remove("show"); void toast.offsetWidth; toast.classList.add("show"); }
    function loadAll(){ try{ const a=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]"); return Array.isArray(a)?a:[]; }catch(e){ return []; } }
    function saveAll(a){ localStorage.setItem(STORAGE_KEY, JSON.stringify(a)); }
    function validate(){
      if(!$("source").value) return "Choose a fertilizer source.";
      if(!$("n").value && !$("p").value && !$("k").value) return "Enter at least one N-P₂O₅-K₂O value.";
      return "";
    }
    $("save").addEventListener("click", ()=>{
      const err=validate(); if(err){ alert(err); return; }
      const item={
        t: Date.now(),
        vendor: $("vendor").value.trim(),
        source: $("source").value,
        form: $("form").value,
        n: $("n").value.trim(), p: $("p").value.trim(), k: $("k").value.trim(),
        micros: $("micros").value.trim(),
        density: $("density").value.trim(),
        densUnit: $("densUnit").value,
        purchaseUnit: $("purchaseUnit").value,
        appliedUnit: $("appliedUnit").value,
        notes: $("notes").value.trim()
      };
      const arr=loadAll(); arr.unshift(item); saveAll(arr); showToast("Fertilizer saved.");
    });
    $("clear").addEventListener("click", ()=>{
      ["vendor","source","form","n","p","k","micros","density","densUnit","purchaseUnit","appliedUnit","notes"].forEach(id=>{
        const el=$(id); if(el.tagName==="SELECT") el.selectedIndex=0; else el.value="";
      });
    });
  })();
  </script>
</body></html>