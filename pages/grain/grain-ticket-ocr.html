<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>FarmVista • Grain Tickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#3B7E46"/>

  <link rel="manifest" href="/Farm-vista/manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="/Farm-vista/assets/icons/apple-touch-icon.png"/>
  <link rel="icon" href="/Farm-vista/assets/icons/icon-192.png"/>

  <!-- Early theme boot -->
  <script src="/Farm-vista/js/theme-boot.js"></script>

  <!-- Global CSS -->
  <link rel="stylesheet" href="/Farm-vista/assets/css/theme.css"/>
  <link rel="stylesheet" href="/Farm-vista/assets/css/app.css"/>

  <!-- ✅ Load core + shell EARLY -->
  <script src="/Farm-vista/js/version.js" defer></script>
  <script src="/Farm-vista/js/core.js" defer></script>
  <script src="/Farm-vista/js/fv-shell.js" defer></script>

  <!-- 2-up / 4-up tile grid -->
  <style>
    .form-tiles{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:clamp(10px,2.5vw,16px)}
    @media(min-width:900px){.form-tiles{grid-template-columns:repeat(4,minmax(0,1fr))}}
  </style>

  <!-- Load <fv-form-button> if needed -->
  <script>
    (function(){
      if(!customElements.get('fv-form-button')){
        const s=document.createElement('script');
        s.src='/Farm-vista/js/fv-form-button.js'; s.defer=true; document.head.appendChild(s);
      }
    })();
  </script>
</head>
<body>
  <fv-shell>
    <div class="page container">
      <h1 class="page-title">Grain Tickets</h1>
      <p class="page-sub">
        Add tickets manually, snap a photo with your phone camera for OCR, or edit existing entries.
      </p>

      <section class="form-tiles" aria-label="Grain ticket actions">
        <fv-form-button label="Add Ticket"   icon-svg="plus"   href="#"></fv-form-button>
        <fv-form-button id="snapTicketBtn" label="Snap Ticket" icon-svg="camera" href="#"></fv-form-button>
        <fv-form-button label="Edit Tickets" icon-svg="edit"   href="#"></fv-form-button>
      </section>

      <!-- Hidden camera input (mobile opens camera) -->
      <input id="cameraInput" type="file" accept="image/*" capture="environment" style="display:none"/>
    </div>
  </fv-shell>

  <noscript>
    <div class="container"><div class="card">JavaScript is required for Grain Tickets.</div></div>
  </noscript>

  <!-- Minimal glue: trigger camera from the tile -->
  <script>
    (function(){
      const btn = document.getElementById('snapTicketBtn');
      const cam = document.getElementById('cameraInput');

      function toast(msg){
        if(window.FV && FV.toast){ FV.toast(msg); } else { console.log(msg); }
      }

      if(btn && cam){
        btn.addEventListener('click', (e)=>{ e.preventDefault(); cam.click(); });
        cam.addEventListener('change', ()=>{
          if(cam.files && cam.files[0]){ toast('Photo selected — ready to process.'); }
        });
      }
    })();
  </script>
</body>
</html>
